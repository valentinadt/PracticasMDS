library(dplyr)
library(MASS)
require(lmtest)
library(readxl)
nba=read.csv("nba.csv")
attach(nba)
data<- na.omit(nba)
set.seed(1234)
#################### 1. Generar un modelo ##################
#Salary como variable dependiente y las demás independientes.
#Primero he hecho un modelo con TODAS las variables, para asegurarme que puedo descartar las cualitativas.
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS.+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
#creo un modelo sin las variables cualitativas, para partir de el como modelo inicial
#selección de las variables para formar el modelo
summary(regres01)
library(WRS2)
anova(regres01)
stepAIC(regres01, direction = "both") #resultado AIC: 14923.2
#modelo resultante (menor AIC, menor cantidad de info perdida):
#lm(formula = Salary ~ NBA_DraftNumber + Age + G + MP + PER + X3PAr + ORB. + TRB. + USG. + WS + OBPM, data = data)
regres02<- lm(Salary ~ NBA_DraftNumber + Age + G + MP + PER + X3PAr + ORB. + TRB. + USG. + WS + OBPM, data = data)
summary(regres02)
#variables no significativas: PER, X3PAR, ORB.,USG Y OBPM| TRB. poco siginficativa
#resultados: p-value: < 2.2e-16 |F-statistic: 50.98 |Multiple R-squared:  0.5435
#valoración global
library(gvlma)
gvlma(regres02)
anova(regres02)
vif(regres02) #problemas de multicolinealidad: PER, MP,G,OBPM
vif(regres02) > 2
BIC(regres01,regres02) #regres01 26 16425.94| regres02 13 16350.24
#realización de un tercer modelo, teniendo en cuenta los problemas de multicolinealidad y la significación: eliminar OBPM Y PER
regres03<- lm(Salary ~ NBA_DraftNumber + Age+ TRB.+ WS, data = data)
summary(regres03) #no sifnificativa TRB, antes ya era poco significativa
vif(regres03) #ya no tengo problemas de multicolinealidad.
#-------------------------------------------------------
#MODELO FINAL:
#-------------------------------------------------------
regres04<- lm(Salary ~ NBA_DraftNumber + Age+ WS, data = data)
summary(regres04) #todas las variables significativas
gvlma(regres04)
vif(regres04) #no hay problema de multicolinealidad
#test Durbin-Watson
dwtest(regres04) #DW= 1.8802 (no hay problema de autocorrelacion) pvalue= 0.09352
#qqplot estudio de la normalidad
library(car)
qqPlot(regres04, labels=row.names(nba), id.method="identify",  #lso valores se distribuyen en torno a la normal más o menos
simulate=TRUE, main="Q-Q Plot")
qqPlot(regres04, labels=row.names(nba), id.method="identify",
simulate=TRUE, main="Q-Q Plot")
#test Jarque Bera
library(fBasics)
library(akima)
vResid4=resid(regres04)
jbTest(vResid4)  #p-value: < 2.2e-16 | LM: 124.003|   ALM: 127.767
#SHAPIRO-WILK
shapiro.test(vResid2)  #W = 0.97389, p-value = 1.373e-07
#LINEALIDAD
crPlots(regres04) #todas las variables más o menos lineales menos OWS
#Estudio de los residuos
residuos04<- residuals(regres04)
hist(residuos04)
require(lmtest)
residplot4 <- function(fit, nbreaks=10) {
z <- rstudent(fit)
hist(z, breaks=nbreaks, freq=FALSE,
xlab="Studentized Residual",
main="Distribution of Errors")
rug(jitter(z), col="brown")
curve(dnorm(x, mean=mean(z), sd=sd(z)),
add=TRUE, col="blue", lwd=2)
lines(density(z)$x, density(z)$y,
col="red", lwd=2, lty=2)
legend("topright",
legend = c( "Normal Curve", "Kernel Density Curve"),
lty=1:2, col=c("blue","red"), cex=.7)
}
residplot4(regres04)   #los valores se distribuyen en torno a la normal, todos dentor de la curva de la normal, menos un trozo entre 1 y 0
#INTERACCIÓN
regresInter=lm(Salary~NBA_DraftNumber*Age*WS,data=nba)
#OUTLIERS
outlierTest(regres04)
#VALORES EXTREMOS
hat.plot <- function(fit) {
p <- length(coefficients(fit))
n <- length(fitted(fit))
plot(hatvalues(fit), main="Index Plot of Hat Values")
abline(h=c(2,3)*p/n, col="red", lty=2)
identify(1:n, hatvalues(fit), names(hatvalues(fit)))
}
hat.plot(regres04)
library(readr)
nba <- read_csv("nba.csv")
View(nba)
knitr::opts_chunk$set(echo = TRUE)
data<- na.omit(nba)
set.seed(1234)
regres01 <- lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS.+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 <- lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS%+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 <- regres01.lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS%+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 <- lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 <- lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS.+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
View(data$`TS%`)
regres01 <- lm('Salary~NBA_DraftNumber'+'Age'+'G'+'MP'+'PER'+'TS.'+'X3PAr'+'FTr'+'ORB.'+'DRB.'+'TRB.'+'AST.'+'STL.'+'BLK.'+'TOV.'+'USG.'+'OWS'+'DWS'+'WS'+'WS.48'+'OBPM'+'DBPM'+'BPM'+'VORP',data)
regres01 <- lm('Salary~NBA_DraftNumber'+Age+'G'+'MP'+'PER'+'TS.'+'X3PAr'+'FTr'+'ORB.'+'DRB.'+'TRB.'+'AST.'+'STL.'+'BLK.'+'TOV.'+'USG.'+'OWS'+'DWS'+'WS'+'WS.48'+'OBPM'+'DBPM'+'BPM'+'VORP',data)
Salary~NBA_DraftNumber+Age+'G'+'MP'+'PER'+'TS.'+'X3PAr'+'FTr'+'ORB.'+'DRB.'+'TRB.'+'AST.'+'STL.'+'BLK.'+'TOV.'+'USG.'+'OWS'+'DWS'+'WS'+'WS.48'+'OBPM'+'DBPM'+'BPM'+'VORP',data)
regres01 <- lm(Salary~NBA_DraftNumber, Age+'G'+'MP'+'PER'+'TS.'+'X3PAr'+'FTr'+'ORB.'+'DRB.'+'TRB.'+'AST.'+'STL.'+'BLK.'+'TOV.'+'USG.'+'OWS'+'DWS'+'WS'+'WS.48'+'OBPM'+'DBPM'+'BPM'+'VORP',data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS%+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+TS.+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+`TS%`+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+`TS%`+X3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+`TS%`+3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+`TS%`+"3PAr"+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 = lm(Salary~NBA_DraftNumber+Age+G+MP+PER+`TS%`+3PAr+FTr+ORB.+DRB.+TRB.+AST.+STL.+BLK.+TOV.+USG.+OWS+DWS+WS+WS.48+OBPM+DBPM+BPM+VORP,data)
regres01 []
